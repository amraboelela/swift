#!/bin/bash

set -e

cd "$(dirname $0)/../../.."
SWIFT_PATH=$PWD

PARAM=x$1
PARAM2=x$2
cd $SWIFT_PATH

if [ ${PARAM} = "x-c" ] || [ ${PARAM2} = "x-c" ] ; then
echo ========== Cleaning ===========
rm -rf build/Ninja-ReleaseAssert
fi

if [ ${PARAM} = "x-u" ] || [ ${PARAM2} = "x-u" ] ; then
echo ========== Syncing ==========
git multi pull
git multi fetch upstream
git multi merge upstream/master
fi

if [ -e $SWIFT_PATH/swift-android-toolchain ] ; then
rm -rf ~/backup/swift-android-toolchain-$(date "+%u")
cp -r swift-android-toolchain ~/backup/swift-android-toolchain-$(date "+%u")
fi

echo ========== Running script ==========
./swift/utils/android/build-toolchain || exit

echo ========== Finishing ==========
cd $SWIFT_PATH

